---
layout: default
title: iptables
tags: 杂项

---

# iptables
创建时间: 2014/04/16 09:17:48  修改时间: 2016/05/16 15:48:55 作者:lijiao

----

## 摘要

iptables是linux自带的防火墙

## 检查点[Chain]

共有五个Chain

	              INPUT                 OUPUT
	                .                     |
	               /_\           +--------+
	                |           _|_
	                +--------+  \ /
	                         |   ' 
	                         Router --------|> FORWARD
	                         .   |                |
	                        /_\  +--------+       |
	                         |           _|_     _|_
	               +---------+           \ /     \ /
	               |                      '       ' 
	    PKT ---> PREROUTING              POSTROUTING  ---> PKT

也可以创建自定义的Chain, 但是最终都会落实上上面的五个Chain：

    iptables [-t table] -N chain

### filter表

IPtables使用的默认表，包含三个检查点

	INPUT
	FORWARD
	OUTPUT:

### nat表

nat表，当遇到一个需要建立新连接的报文时，使用该表

	PREROUTING
	OUTPUT
	POSTROUTING

### mangle表

mangle表用于修改特定的报文

	PREROUTING
	OUTPUT
	INPUT

### raw表

raw表用于配置连接跟踪的例外情况

	PREROUTING
	OUTPUT

### security表

## 查看规则

如果不指定table，默认查看的是filter表的所有chain。

    iptables [-t table] {-F|-L|-Z} [chain [rulenum]] [options...]

## 通信数据劫持

被劫持机:

	ip: 192.168.1.10
	netmask: 255.255.255.0
	gateway: 192.168.1.1

劫持机有两个网卡eth0和eth1

	eth0:  内网口, 接入被劫持机
		ip: 192.168.1.1
		netmask: 255.255.255.0
	
	eth1:  外网口, 接入外网
		ip: 172.19.1.10
		netmask: 255.255.255.0
		gateway: 172.19.1.1
		dns: 172.19.1.1

在劫持机上配置规则:

	eth1发出的源IP为192.168.1.10的包，源地址被改写为172.19.1.10
		iptables -t nat -A POSTROUTING -o eth1 -s 192.168.1.10 -j SNAT --to 172.19.1.10

	eth1接收的目的地址为172.19.1.10的包，目的地址被改写为192.168.1.10
		iptables -t nat -A PREROUTING -i eth1 -d 172.19.1.10 -j DNAT --to 192.168.1.10

## 文献
1. man iptables

